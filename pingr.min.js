angular.module("pingr",[]).service("pingr",["$http","$interval","$window","$timeout",function(a,b,c,d){var e={cached:null,intervalPromise:null,opts:{message:"There are new updates available. Do you want to reload?",interval:60,endpoint:"",retry:300,onChange:null},init:function(a){if(angular.extend(a,this.opts),!this.opts.endpoint)throw new Error("Endpoint is required.");this.start()},start:function(){var a=1e3*this.opts.interval;this.intervalPromise=b(function(){e.ping()},a)},ping:function(){a.get(this.opts.endpoint).then(function(a){var b=null;if("string"==typeof a.data)b=a.data;else for(var c in a.data)if("function"!=typeof c){b=a.data[c];break}if(null===b)throw new Error('Pingr could not interpret response from endpoint "'+this.opts.endpoint+'"');return null===e.cached?void(e.cached=b):void(e.cached!==b&&e.onChange())},function(a){throw console.log("Pingr failure reply:",a),new Error('Pingr could not reach endpoint "'+this.opts.endpoint+'"')})},onChange:function(){return"function"==typeof this.opts.onChange?void this.opts.onChange(this):void this.reload()},reload:function(){if(c.confirm(this.opts.message))c.location.reload();else if(this.cancel(),this.opts.retry!==!1){var a=1e3*this.opts.retry;d(function(){e.start()},a)}},cancel:function(){b.cancel(this.intervalPromise)}};return e}]);