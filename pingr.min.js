angular.module("pingr").service("pingr",["$http","$interval","$window","$timeout",function(a,b,c,d){var e={cached:null,intervalPromise:null,opts:{message:"There are new updates available. Do you want to reload?",interval:"60",endpoint:"",retry:"300"},init:function(a){for(var b in a)this.opts[b]=a[b];if(!this.opts.endpoint)throw new Error("Endpoint is required.");this.start()},start:function(){var a=1e3*this.opts.interval;this.intervalPromise=b(function(){e.ping()},a)},ping:function(){a.post(this.opts.endpoint).then(function(a){var b=null;for(var c in a.data)if("function"!=typeof c){b=a.data[c];break}if(null===b)throw new Error('Pingr could not interpret response from endpoint "'+this.opts.endpoint+'"');return null===e.cached?void(e.cached=b):void(e.cached!==b&&e.reload())},function(a){throw console.log("Pingr failure reply:",a),new Error('Pingr could not reach endpoint "'+this.opts.endpoint+'"')})},reload:function(){if(c.confirm(this.opts.message))c.location.reload();else if(b.cancel(this.intervalPromise),this.opts.retry!==!1){var a=1e3*this.opts.retry;d(function(){e.start()},a)}}};return e}]);